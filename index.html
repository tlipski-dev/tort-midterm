<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tort Quiz — One-at-a-Time</title>
<style>
  body{font-family:sans-serif;max-width:700px;margin:20px auto;padding:0 15px;background:#f6f7fb;color:#111}
  header{background:#111;color:#fff;padding:20px;border-radius:10px}
  header h1{margin:0}
  .card{background:#fff;border:1px solid #ddd;border-radius:10px;padding:15px;margin:20px 0}
  .choices{display:grid;gap:8px;margin-top:10px}
  .choice{border:1px solid #ccc;border-radius:8px;padding:10px;background:#fafafe;text-align:left;cursor:pointer}
  .choice.correct{border-color:green;background:#e6ffed}
  .choice.incorrect{border-color:red;background:#ffe6e6}
  .feedback{margin-top:10px;display:none;padding:10px;border-radius:8px}
  .feedback.ok{background:#e6ffed;border:1px solid green}
  .feedback.no{background:#ffe6e6;border:1px solid red}
  .toolbar{margin:15px 0;display:flex;gap:10px;flex-wrap:wrap}
  button{padding:10px 14px;border:1px solid #ccc;border-radius:8px;cursor:pointer}
  button.primary{background:#111;color:#fff;border-color:#111}
</style>
</head>
<body>
<header>
  <h1>Tort Quiz — One-at-a-Time</h1>
</header>

<div id="quiz"></div>

<div class="toolbar">
  <button id="nextBtn" class="primary" style="display:none">Next Question</button>
  <span id="progress"></span>
</div>

<script>
let QUESTIONS = [];
let asked = [];
let currentIndex = null;
let score = 0;

const quizEl = document.getElementById('quiz');
const nextBtn = document.getElementById('nextBtn');
const progress = document.getElementById('progress');

async function loadQuestions() {
  try {
    const res = await fetch('questions.json', {cache:'no-store'});
    QUESTIONS = await res.json();
  } catch (e) {
    QUESTIONS = [];
  }
  showRandomQuestion();
}

function showRandomQuestion() {
  quizEl.innerHTML = '';
  nextBtn.style.display = 'none';

  if (asked.length === QUESTIONS.length) {
    quizEl.innerHTML = `<div class="card"><h3>Quiz finished!</h3><p>You scored ${score} / ${QUESTIONS.length}.</p></div>`;
    progress.textContent = '';
    return;
  }

  // pick random unused index
  do {
    currentIndex = Math.floor(Math.random() * QUESTIONS.length);
  } while (asked.includes(currentIndex));

  asked.push(currentIndex);
  const q = QUESTIONS[currentIndex];

  const card = document.createElement('div');
  card.className = 'card';

  const title = document.createElement('h3');
  title.textContent = `Q${asked.length}. ${q.question}`;
  card.appendChild(title);

  const choices = document.createElement('div');
  choices.className = 'choices';

  q.choices.forEach((text, cIdx) => {
    const btn = document.createElement('button');
    btn.className = 'choice';
    btn.textContent = text;
    btn.addEventListener('click', () => onChoose(card, btn, cIdx === q.answer_index, q));
    choices.appendChild(btn);
  });

  const fb = document.createElement('div');
  fb.className = 'feedback';
  card.appendChild(choices);
  card.appendChild(fb);

  quizEl.appendChild(card);

  progress.textContent = `Question ${asked.length} of ${QUESTIONS.length}`;
}

function onChoose(card, btn, correct, q) {
  const buttons = card.querySelectorAll('.choice');
  buttons.forEach(b => b.disabled = true);
  if (buttons[q.answer_index]) buttons[q.answer_index].classList.add('correct');
  if (!correct) btn.classList.add('incorrect');

  const fb = card.querySelector('.feedback');
  fb.style.display = 'block';
  if (correct) {
    fb.classList.add('ok');
    fb.innerHTML = `<strong>Correct!</strong><br>${q.explanation||''}`;
    score++;
  } else {
    fb.classList.add('no');
    fb.innerHTML = `<strong>Incorrect.</strong> Correct answer: <em>${q.choices[q.answer_index]}</em><br>${q.explanation||''}`;
  }

  nextBtn.style.display = 'inline-block';
}

nextBtn.addEventListener('click', showRandomQuestion);

loadQuestions();
</script>
</body>
</html>
